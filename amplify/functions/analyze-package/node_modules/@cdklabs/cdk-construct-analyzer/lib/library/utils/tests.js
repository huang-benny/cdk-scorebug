"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.analyzeTestsPresence = analyzeTestsPresence;
/**
 * Analyze repository contents to detect presence of unit tests and snapshot tests
 */
function analyzeTestsPresence(repository) {
    const entries = repository.rootContents?.entries ?? [];
    return {
        hasUnitTests: hasUnitTests(entries),
        hasSnapshotTests: hasSnapshotTests(entries),
    };
}
function hasUnitTests(entries) {
    return entries.some(entry => entry.name.toLowerCase().includes('test') ||
        (entry.type === 'tree' && entry.object?.entries?.some(file => file.type === 'blob' && file.name.includes('test'))));
}
function hasSnapshotTests(entries, depth = 0) {
    // GitHubRepositoryEntry also only stores contents up to 4 layers deep so this depths parameter
    // has no use for now, but I think it's good to have
    if (depth > 3)
        return false;
    return entries.some(entry => {
        if (isSnapshotRelated(entry.name))
            return true;
        if (entry.type === 'tree' && entry.object?.entries) {
            return hasSnapshotTests(entry.object.entries, depth + 1);
        }
        return false;
    });
}
function isSnapshotRelated(name) {
    return name.toLowerCase().includes('snapshot') || name.endsWith('.snap');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGlicmFyeS91dGlscy90ZXN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLG9EQU9DO0FBVkQ7O0dBRUc7QUFDSCxTQUFnQixvQkFBb0IsQ0FBQyxVQUE0QjtJQUMvRCxNQUFNLE9BQU8sR0FBRyxVQUFVLENBQUMsWUFBWSxFQUFFLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFFdkQsT0FBTztRQUNMLFlBQVksRUFBRSxZQUFZLENBQUMsT0FBTyxDQUFDO1FBQ25DLGdCQUFnQixFQUFFLGdCQUFnQixDQUFDLE9BQU8sQ0FBQztLQUM1QyxDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsWUFBWSxDQUFDLE9BQWdDO0lBQ3BELE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUMxQixLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDekMsQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDM0QsSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQ25ELENBQUMsQ0FDSCxDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsZ0JBQWdCLENBQUMsT0FBZ0MsRUFBRSxLQUFLLEdBQUcsQ0FBQztJQUNuRSwrRkFBK0Y7SUFDL0Ysb0RBQW9EO0lBQ3BELElBQUksS0FBSyxHQUFHLENBQUM7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUU1QixPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDMUIsSUFBSSxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFFL0MsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxDQUFDO1lBQ25ELE9BQU8sZ0JBQWdCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzNELENBQUM7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELFNBQVMsaUJBQWlCLENBQUMsSUFBWTtJQUNyQyxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMzRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBHaXRIdWJSZXBvc2l0b3J5LCBHaXRIdWJSZXBvc2l0b3J5RW50cnksIFRlc3RzRGF0YSB9IGZyb20gJy4uL3R5cGVzJztcblxuLyoqXG4gKiBBbmFseXplIHJlcG9zaXRvcnkgY29udGVudHMgdG8gZGV0ZWN0IHByZXNlbmNlIG9mIHVuaXQgdGVzdHMgYW5kIHNuYXBzaG90IHRlc3RzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhbmFseXplVGVzdHNQcmVzZW5jZShyZXBvc2l0b3J5OiBHaXRIdWJSZXBvc2l0b3J5KTogVGVzdHNEYXRhIHtcbiAgY29uc3QgZW50cmllcyA9IHJlcG9zaXRvcnkucm9vdENvbnRlbnRzPy5lbnRyaWVzID8/IFtdO1xuXG4gIHJldHVybiB7XG4gICAgaGFzVW5pdFRlc3RzOiBoYXNVbml0VGVzdHMoZW50cmllcyksXG4gICAgaGFzU25hcHNob3RUZXN0czogaGFzU25hcHNob3RUZXN0cyhlbnRyaWVzKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gaGFzVW5pdFRlc3RzKGVudHJpZXM6IEdpdEh1YlJlcG9zaXRvcnlFbnRyeVtdKTogYm9vbGVhbiB7XG4gIHJldHVybiBlbnRyaWVzLnNvbWUoZW50cnkgPT5cbiAgICBlbnRyeS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3Rlc3QnKSB8fFxuICAgIChlbnRyeS50eXBlID09PSAndHJlZScgJiYgZW50cnkub2JqZWN0Py5lbnRyaWVzPy5zb21lKGZpbGUgPT5cbiAgICAgIGZpbGUudHlwZSA9PT0gJ2Jsb2InICYmIGZpbGUubmFtZS5pbmNsdWRlcygndGVzdCcpLFxuICAgICkpLFxuICApO1xufVxuXG5mdW5jdGlvbiBoYXNTbmFwc2hvdFRlc3RzKGVudHJpZXM6IEdpdEh1YlJlcG9zaXRvcnlFbnRyeVtdLCBkZXB0aCA9IDApOiBib29sZWFuIHtcbiAgLy8gR2l0SHViUmVwb3NpdG9yeUVudHJ5IGFsc28gb25seSBzdG9yZXMgY29udGVudHMgdXAgdG8gNCBsYXllcnMgZGVlcCBzbyB0aGlzIGRlcHRocyBwYXJhbWV0ZXJcbiAgLy8gaGFzIG5vIHVzZSBmb3Igbm93LCBidXQgSSB0aGluayBpdCdzIGdvb2QgdG8gaGF2ZVxuICBpZiAoZGVwdGggPiAzKSByZXR1cm4gZmFsc2U7XG5cbiAgcmV0dXJuIGVudHJpZXMuc29tZShlbnRyeSA9PiB7XG4gICAgaWYgKGlzU25hcHNob3RSZWxhdGVkKGVudHJ5Lm5hbWUpKSByZXR1cm4gdHJ1ZTtcblxuICAgIGlmIChlbnRyeS50eXBlID09PSAndHJlZScgJiYgZW50cnkub2JqZWN0Py5lbnRyaWVzKSB7XG4gICAgICByZXR1cm4gaGFzU25hcHNob3RUZXN0cyhlbnRyeS5vYmplY3QuZW50cmllcywgZGVwdGggKyAxKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBpc1NuYXBzaG90UmVsYXRlZChuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIG5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc25hcHNob3QnKSB8fCBuYW1lLmVuZHNXaXRoKCcuc25hcCcpO1xufSJdfQ==