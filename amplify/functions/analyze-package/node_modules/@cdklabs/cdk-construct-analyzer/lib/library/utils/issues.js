"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateTimeToFirstResponse = calculateTimeToFirstResponse;
exports.calculateOpenIssuesRatio = calculateOpenIssuesRatio;
const contributors_1 = require("./contributors");
/**
 * Calculate average time to first response for issues (in weeks)
 *
 * Returns undefined when:
 * - No issues provided or empty array
 * - No issues have any responses from non-authors
 * - All responses are from bots/automation or the issue authors themselves
 */
function calculateTimeToFirstResponse(issues) {
    if (!issues || issues.length === 0) {
        return undefined;
    }
    const responseTimes = [];
    for (const issue of issues) {
        if (!issue.author?.login || !issue.comments?.nodes?.length) {
            continue;
        }
        const issueCreatedAt = new Date(issue.createdAt);
        const issueAuthor = issue.author.login;
        // Find first response from someone other than the issue author
        const firstResponse = issue.comments.nodes.find(comment => comment.author?.login &&
            comment.author.login !== issueAuthor &&
            !(0, contributors_1.isBotOrAutomated)(comment.author.login));
        if (firstResponse) {
            const responseTime = new Date(firstResponse.createdAt);
            const timeDiffMs = responseTime.getTime() - issueCreatedAt.getTime();
            const timeDiffWeeks = timeDiffMs / (1000 * 60 * 60 * 24 * 7);
            if (timeDiffWeeks >= 0) {
                responseTimes.push(timeDiffWeeks);
            }
        }
    }
    if (responseTimes.length === 0) {
        return undefined;
    }
    // Calculate average
    const average = responseTimes.reduce((sum, time) => sum + time, 0) / responseTimes.length;
    return Math.round(average * 10) / 10; // Round to 1 decimal places for better precision
}
/**
 * Calculate the percentage of open issues relative to total issues
 *
 * Returns undefined when:
 * - openIssuesCount or totalIssuesCount is undefined
 * - totalIssuesCount is 0 (no issues to calculate ratio)
 */
function calculateOpenIssuesRatio(openIssuesCount, totalIssuesCount) {
    if (openIssuesCount === undefined || totalIssuesCount === undefined) {
        return 100;
    }
    if (totalIssuesCount === 0) {
        return 100;
    }
    const ratio = (openIssuesCount / totalIssuesCount) * 100;
    return Math.round(ratio * 10) / 10; // Round to 1 decimal place
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXNzdWVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYnJhcnkvdXRpbHMvaXNzdWVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBV0Esb0VBd0NDO0FBU0QsNERBV0M7QUF0RUQsaURBQWtEO0FBRWxEOzs7Ozs7O0dBT0c7QUFDSCxTQUFnQiw0QkFBNEIsQ0FBQyxNQUFzQjtJQUNqRSxJQUFJLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDbkMsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELE1BQU0sYUFBYSxHQUFhLEVBQUUsQ0FBQztJQUVuQyxLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDO1lBQzNELFNBQVM7UUFDWCxDQUFDO1FBRUQsTUFBTSxjQUFjLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2pELE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBRXZDLCtEQUErRDtRQUMvRCxNQUFNLGFBQWEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQzdDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxLQUFLO1lBQ3RCLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxLQUFLLFdBQVc7WUFDcEMsQ0FBQyxJQUFBLCtCQUFnQixFQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQ2xELENBQUM7UUFFRixJQUFJLGFBQWEsRUFBRSxDQUFDO1lBQ2xCLE1BQU0sWUFBWSxHQUFHLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN2RCxNQUFNLFVBQVUsR0FBRyxZQUFZLENBQUMsT0FBTyxFQUFFLEdBQUcsY0FBYyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3JFLE1BQU0sYUFBYSxHQUFHLFVBQVUsR0FBRyxDQUFDLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUU3RCxJQUFJLGFBQWEsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDdkIsYUFBYSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNwQyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxJQUFJLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDL0IsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELG9CQUFvQjtJQUNwQixNQUFNLE9BQU8sR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsR0FBRyxHQUFHLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDO0lBQzFGLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsaURBQWlEO0FBQ3pGLENBQUM7QUFFRDs7Ozs7O0dBTUc7QUFDSCxTQUFnQix3QkFBd0IsQ0FBQyxlQUF3QixFQUFFLGdCQUF5QjtJQUMxRixJQUFJLGVBQWUsS0FBSyxTQUFTLElBQUksZ0JBQWdCLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDcEUsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDO0lBRUQsSUFBSSxnQkFBZ0IsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUMzQixPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxDQUFDLGVBQWUsR0FBRyxnQkFBZ0IsQ0FBQyxHQUFHLEdBQUcsQ0FBQztJQUN6RCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLDJCQUEyQjtBQUNqRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR2l0SHViSXNzdWUgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBpc0JvdE9yQXV0b21hdGVkIH0gZnJvbSAnLi9jb250cmlidXRvcnMnO1xuXG4vKipcbiAqIENhbGN1bGF0ZSBhdmVyYWdlIHRpbWUgdG8gZmlyc3QgcmVzcG9uc2UgZm9yIGlzc3VlcyAoaW4gd2Vla3MpXG4gKlxuICogUmV0dXJucyB1bmRlZmluZWQgd2hlbjpcbiAqIC0gTm8gaXNzdWVzIHByb3ZpZGVkIG9yIGVtcHR5IGFycmF5XG4gKiAtIE5vIGlzc3VlcyBoYXZlIGFueSByZXNwb25zZXMgZnJvbSBub24tYXV0aG9yc1xuICogLSBBbGwgcmVzcG9uc2VzIGFyZSBmcm9tIGJvdHMvYXV0b21hdGlvbiBvciB0aGUgaXNzdWUgYXV0aG9ycyB0aGVtc2VsdmVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVUaW1lVG9GaXJzdFJlc3BvbnNlKGlzc3Vlcz86IEdpdEh1Yklzc3VlW10pOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICBpZiAoIWlzc3VlcyB8fCBpc3N1ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNvbnN0IHJlc3BvbnNlVGltZXM6IG51bWJlcltdID0gW107XG5cbiAgZm9yIChjb25zdCBpc3N1ZSBvZiBpc3N1ZXMpIHtcbiAgICBpZiAoIWlzc3VlLmF1dGhvcj8ubG9naW4gfHwgIWlzc3VlLmNvbW1lbnRzPy5ub2Rlcz8ubGVuZ3RoKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBpc3N1ZUNyZWF0ZWRBdCA9IG5ldyBEYXRlKGlzc3VlLmNyZWF0ZWRBdCk7XG4gICAgY29uc3QgaXNzdWVBdXRob3IgPSBpc3N1ZS5hdXRob3IubG9naW47XG5cbiAgICAvLyBGaW5kIGZpcnN0IHJlc3BvbnNlIGZyb20gc29tZW9uZSBvdGhlciB0aGFuIHRoZSBpc3N1ZSBhdXRob3JcbiAgICBjb25zdCBmaXJzdFJlc3BvbnNlID0gaXNzdWUuY29tbWVudHMubm9kZXMuZmluZChcbiAgICAgIGNvbW1lbnQgPT4gY29tbWVudC5hdXRob3I/LmxvZ2luICYmXG4gICAgICAgICAgICAgICAgY29tbWVudC5hdXRob3IubG9naW4gIT09IGlzc3VlQXV0aG9yICYmXG4gICAgICAgICAgICAgICAgIWlzQm90T3JBdXRvbWF0ZWQoY29tbWVudC5hdXRob3IubG9naW4pLFxuICAgICk7XG5cbiAgICBpZiAoZmlyc3RSZXNwb25zZSkge1xuICAgICAgY29uc3QgcmVzcG9uc2VUaW1lID0gbmV3IERhdGUoZmlyc3RSZXNwb25zZS5jcmVhdGVkQXQpO1xuICAgICAgY29uc3QgdGltZURpZmZNcyA9IHJlc3BvbnNlVGltZS5nZXRUaW1lKCkgLSBpc3N1ZUNyZWF0ZWRBdC5nZXRUaW1lKCk7XG4gICAgICBjb25zdCB0aW1lRGlmZldlZWtzID0gdGltZURpZmZNcyAvICgxMDAwICogNjAgKiA2MCAqIDI0ICogNyk7XG5cbiAgICAgIGlmICh0aW1lRGlmZldlZWtzID49IDApIHtcbiAgICAgICAgcmVzcG9uc2VUaW1lcy5wdXNoKHRpbWVEaWZmV2Vla3MpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChyZXNwb25zZVRpbWVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyBDYWxjdWxhdGUgYXZlcmFnZVxuICBjb25zdCBhdmVyYWdlID0gcmVzcG9uc2VUaW1lcy5yZWR1Y2UoKHN1bSwgdGltZSkgPT4gc3VtICsgdGltZSwgMCkgLyByZXNwb25zZVRpbWVzLmxlbmd0aDtcbiAgcmV0dXJuIE1hdGgucm91bmQoYXZlcmFnZSAqIDEwKSAvIDEwOyAvLyBSb3VuZCB0byAxIGRlY2ltYWwgcGxhY2VzIGZvciBiZXR0ZXIgcHJlY2lzaW9uXG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIHRoZSBwZXJjZW50YWdlIG9mIG9wZW4gaXNzdWVzIHJlbGF0aXZlIHRvIHRvdGFsIGlzc3Vlc1xuICpcbiAqIFJldHVybnMgdW5kZWZpbmVkIHdoZW46XG4gKiAtIG9wZW5Jc3N1ZXNDb3VudCBvciB0b3RhbElzc3Vlc0NvdW50IGlzIHVuZGVmaW5lZFxuICogLSB0b3RhbElzc3Vlc0NvdW50IGlzIDAgKG5vIGlzc3VlcyB0byBjYWxjdWxhdGUgcmF0aW8pXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVPcGVuSXNzdWVzUmF0aW8ob3Blbklzc3Vlc0NvdW50PzogbnVtYmVyLCB0b3RhbElzc3Vlc0NvdW50PzogbnVtYmVyKTogbnVtYmVyIHtcbiAgaWYgKG9wZW5Jc3N1ZXNDb3VudCA9PT0gdW5kZWZpbmVkIHx8IHRvdGFsSXNzdWVzQ291bnQgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiAxMDA7XG4gIH1cblxuICBpZiAodG90YWxJc3N1ZXNDb3VudCA9PT0gMCkge1xuICAgIHJldHVybiAxMDA7XG4gIH1cblxuICBjb25zdCByYXRpbyA9IChvcGVuSXNzdWVzQ291bnQgLyB0b3RhbElzc3Vlc0NvdW50KSAqIDEwMDtcbiAgcmV0dXJuIE1hdGgucm91bmQocmF0aW8gKiAxMCkgLyAxMDsgLy8gUm91bmQgdG8gMSBkZWNpbWFsIHBsYWNlXG59XG4iXX0=