"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.cli = cli;
const chalk_1 = __importDefault(require("chalk"));
const yargs_1 = __importDefault(require("yargs"));
const helpers_1 = require("yargs/helpers");
const analyzer_1 = require("../library/analyzer");
function convertToStars(rating) {
    const fullStars = chalk_1.default.yellow('★'.repeat(rating));
    const emptyStars = chalk_1.default.gray('☆'.repeat(5 - rating));
    return fullStars + emptyStars;
}
/**
 * Converts signal names to Display Name format
 * Examples:
 * - "weeklyDownloads" -> "Weekly Downloads"
 * - "numberOfContributors_Maintenance" -> "Number Of Contributors - Maintenance"
 */
function convertToDisplayName(signalName) {
    return signalName
        .replace(/_/g, ' - ') // Convert underscore to dash with spaces
        .replace(/([A-Z])/g, ' $1') // Add space before capital letters everywhere
        .replace(/^./, str => str.toUpperCase()) // Capitalize first letter
        .replace(/\s+/g, ' ') // Clean up multiple spaces
        .trim();
}
function displayDetailsSignalInfo(signalScores, weights) {
    console.log(chalk_1.default.gray('\n---'));
    Object.entries(signalScores).forEach(([pillar, signals]) => {
        const pillarString = '\n=== ' + pillar + ' ===';
        console.log(chalk_1.default.bold.cyan(`${pillarString.padEnd(54)}`), chalk_1.default.bold('SCORE  WEIGHT'));
        Object.entries(signals).forEach(([signal, score]) => {
            const displayName = convertToDisplayName(signal);
            const dots = chalk_1.default.gray('.'.repeat(Math.max(1, 50 - displayName.length)));
            const stars = convertToStars(score);
            const signalWeight = weights[pillar][signal];
            console.log(`${chalk_1.default.dim('—')} ${displayName} ${dots} ${stars}    ${chalk_1.default.cyan(signalWeight)}`);
        });
    });
}
function cli() {
    const analyzer = new analyzer_1.ConstructAnalyzer();
    void (0, yargs_1.default)((0, helpers_1.hideBin)(process.argv))
        .command('$0 <package>', 'Usage: cdk-construct-analyzer <package> [options]', (yargsBuilder) => {
        return yargsBuilder
            .positional('package', {
            describe: 'NPM package name to analyze (e.g., "@aws-cdk/core")',
            type: 'string',
            demandOption: true,
        })
            .option('details', {
            alias: 'v',
            type: 'boolean',
            default: false,
            describe: 'Show detailed signal information',
        });
    }, async (argv) => {
        try {
            const result = await analyzer.analyzePackage(argv.package);
            const weights = result.signalWeights;
            console.log(chalk_1.default.bold('\nLIBRARY:'), chalk_1.default.blue(result.packageName));
            console.log(chalk_1.default.bold('VERSION:'), chalk_1.default.blue(result.version));
            // Color overall score based on value
            let scoreColor;
            if (result.totalScore >= 80) {
                scoreColor = chalk_1.default.green;
            }
            else if (result.totalScore >= 60) {
                scoreColor = chalk_1.default.yellow;
            }
            else {
                scoreColor = chalk_1.default.red;
            }
            console.log(chalk_1.default.bold('\nOVERALL SCORE:'), scoreColor(`${result.totalScore}/100`));
            console.log(chalk_1.default.gray('\n---'));
            console.log(chalk_1.default.bold('\nSUBSCORES'));
            Object.entries(result.pillarScores).forEach(([pillar, score]) => {
                // Color subscore based on value
                let pillarColor;
                if (score >= 80) {
                    pillarColor = chalk_1.default.green;
                }
                else if (score >= 60) {
                    pillarColor = chalk_1.default.yellow;
                }
                else {
                    pillarColor = chalk_1.default.red;
                }
                console.log(`  ${chalk_1.default.cyan(pillar.padEnd(12))}: ${pillarColor(score.toString().padStart(12) + '/100')}`);
            });
            // Only show detailed signal information if details flag is set
            if (argv.details) {
                displayDetailsSignalInfo(result.signalScores, weights);
            }
        }
        catch (error) {
            console.error(chalk_1.default.red('Error:'), error instanceof Error ? error.message : error);
            process.exit(1);
        }
    })
        .help()
        .argv;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NsaS9jbGkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUE0Q0Esa0JBb0VDO0FBaEhELGtEQUEwQjtBQUMxQixrREFBMEI7QUFDMUIsMkNBQXdDO0FBQ3hDLGtEQUF3RDtBQUV4RCxTQUFTLGNBQWMsQ0FBQyxNQUFjO0lBQ3BDLE1BQU0sU0FBUyxHQUFHLGVBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ25ELE1BQU0sVUFBVSxHQUFHLGVBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN0RCxPQUFPLFNBQVMsR0FBRyxVQUFVLENBQUM7QUFDaEMsQ0FBQztBQUVEOzs7OztHQUtHO0FBQ0gsU0FBUyxvQkFBb0IsQ0FBQyxVQUFrQjtJQUM5QyxPQUFPLFVBQVU7U0FDZCxPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDLHlDQUF5QztTQUM5RCxPQUFPLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDLDhDQUE4QztTQUN6RSxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsMEJBQTBCO1NBQ2xFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsMkJBQTJCO1NBQ2hELElBQUksRUFBRSxDQUFDO0FBQ1osQ0FBQztBQUVELFNBQVMsd0JBQXdCLENBQUMsWUFBb0QsRUFBRSxPQUErQztJQUNySSxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUVqQyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxF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SCwrREFBK0Q7WUFDL0QsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ2pCLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDekQsQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxlQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25GLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEIsQ0FBQztJQUNILENBQUMsQ0FDRjtTQUNBLElBQUksRUFBRTtTQUNOLElBQUksQ0FBQztBQUNWLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnO1xuaW1wb3J0IHlhcmdzIGZyb20gJ3lhcmdzJztcbmltcG9ydCB7IGhpZGVCaW4gfSBmcm9tICd5YXJncy9oZWxwZXJzJztcbmltcG9ydCB7IENvbnN0cnVjdEFuYWx5emVyIH0gZnJvbSAnLi4vbGlicmFyeS9hbmFseXplcic7XG5cbmZ1bmN0aW9uIGNvbnZlcnRUb1N0YXJzKHJhdGluZzogbnVtYmVyKTogc3RyaW5nIHtcbiAgY29uc3QgZnVsbFN0YXJzID0gY2hhbGsueWVsbG93KCfimIUnLnJlcGVhdChyYXRpbmcpKTtcbiAgY29uc3QgZW1wdHlTdGFycyA9IGNoYWxrLmdyYXkoJ+KYhicucmVwZWF0KDUgLSByYXRpbmcpKTtcbiAgcmV0dXJuIGZ1bGxTdGFycyArIGVtcHR5U3RhcnM7XG59XG5cbi8qKlxuICogQ29udmVydHMgc2lnbmFsIG5hbWVzIHRvIERpc3BsYXkgTmFtZSBmb3JtYXRcbiAqIEV4YW1wbGVzOlxuICogLSBcIndlZWtseURvd25sb2Fkc1wiIC0+IFwiV2Vla2x5IERvd25sb2Fkc1wiXG4gKiAtIFwibnVtYmVyT2ZDb250cmlidXRvcnNfTWFpbnRlbmFuY2VcIiAtPiBcIk51bWJlciBPZiBDb250cmlidXRvcnMgLSBNYWludGVuYW5jZVwiXG4gKi9cbmZ1bmN0aW9uIGNvbnZlcnRUb0Rpc3BsYXlOYW1lKHNpZ25hbE5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBzaWduYWxOYW1lXG4gICAgLnJlcGxhY2UoL18vZywgJyAtICcpIC8vIENvbnZlcnQgdW5kZXJzY29yZSB0byBkYXNoIHdpdGggc3BhY2VzXG4gICAgLnJlcGxhY2UoLyhbQS1aXSkvZywgJyAkMScpIC8vIEFkZCBzcGFjZSBiZWZvcmUgY2FwaXRhbCBsZXR0ZXJzIGV2ZXJ5d2hlcmVcbiAgICAucmVwbGFjZSgvXi4vLCBzdHIgPT4gc3RyLnRvVXBwZXJDYXNlKCkpIC8vIENhcGl0YWxpemUgZmlyc3QgbGV0dGVyXG4gICAgLnJlcGxhY2UoL1xccysvZywgJyAnKSAvLyBDbGVhbiB1cCBtdWx0aXBsZSBzcGFjZXNcbiAgICAudHJpbSgpO1xufVxuXG5mdW5jdGlvbiBkaXNwbGF5RGV0YWlsc1NpZ25hbEluZm8oc2lnbmFsU2NvcmVzOiBSZWNvcmQ8c3RyaW5nLCBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+Piwgd2VpZ2h0czogUmVjb3JkPHN0cmluZywgUmVjb3JkPHN0cmluZywgbnVtYmVyPj4pOiB2b2lkIHtcbiAgY29uc29sZS5sb2coY2hhbGsuZ3JheSgnXFxuLS0tJykpO1xuXG4gIE9iamVjdC5lbnRyaWVzKHNpZ25hbFNjb3JlcykuZm9yRWFjaCgoW3BpbGxhciwgc2lnbmFsc10pID0+IHtcbiAgICBjb25zdCBwaWxsYXJTdHJpbmcgPSAnXFxuPT09ICcgKyBwaWxsYXIgKyAnID09PSc7XG4gICAgY29uc29sZS5sb2coY2hhbGsuYm9sZC5jeWFuKGAke3BpbGxhclN0cmluZy5wYWRFbmQoNTQpfWApLCBjaGFsay5ib2xkKCdTQ09SRSAgV0VJR0hUJykpO1xuXG4gICAgT2JqZWN0LmVudHJpZXMoc2lnbmFscyBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KS5mb3JFYWNoKChbc2lnbmFsLCBzY29yZV0pID0+IHtcbiAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gY29udmVydFRvRGlzcGxheU5hbWUoc2lnbmFsKTtcbiAgICAgIGNvbnN0IGRvdHMgPSBjaGFsay5ncmF5KCcuJy5yZXBlYXQoTWF0aC5tYXgoMSwgNTAgLSBkaXNwbGF5TmFtZS5sZW5ndGgpKSk7XG4gICAgICBjb25zdCBzdGFycyA9IGNvbnZlcnRUb1N0YXJzKHNjb3JlKTtcbiAgICAgIGNvbnN0IHNpZ25hbFdlaWdodCA9IHdlaWdodHNbcGlsbGFyXVtzaWduYWxdO1xuXG4gICAgICBjb25zb2xlLmxvZyhgJHtjaGFsay5kaW0oJ+KAlCcpfSAke2Rpc3BsYXlOYW1lfSAke2RvdHN9ICR7c3RhcnN9ICAgICR7Y2hhbGsuY3lhbihzaWduYWxXZWlnaHQpfWApO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsaSgpIHtcbiAgY29uc3QgYW5hbHl6ZXIgPSBuZXcgQ29uc3RydWN0QW5hbHl6ZXIoKTtcblxuICB2b2lkIHlhcmdzKGhpZGVCaW4ocHJvY2Vzcy5hcmd2KSlcbiAgICAuY29tbWFuZChcbiAgICAgICckMCA8cGFja2FnZT4nLFxuICAgICAgJ1VzYWdlOiBjZGstY29uc3RydWN0LWFuYWx5emVyIDxwYWNrYWdlPiBbb3B0aW9uc10nLFxuICAgICAgKHlhcmdzQnVpbGRlcikgPT4ge1xuICAgICAgICByZXR1cm4geWFyZ3NCdWlsZGVyXG4gICAgICAgICAgLnBvc2l0aW9uYWwoJ3BhY2thZ2UnLCB7XG4gICAgICAgICAgICBkZXNjcmliZTogJ05QTSBwYWNrYWdlIG5hbWUgdG8gYW5hbHl6ZSAoZS5nLiwgXCJAYXdzLWNkay9jb3JlXCIpJyxcbiAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgICAgZGVtYW5kT3B0aW9uOiB0cnVlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLm9wdGlvbignZGV0YWlscycsIHtcbiAgICAgICAgICAgIGFsaWFzOiAndicsXG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICAgICAgICAgIGRlc2NyaWJlOiAnU2hvdyBkZXRhaWxlZCBzaWduYWwgaW5mb3JtYXRpb24nLFxuICAgICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIChhcmd2KSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5hbHl6ZXIuYW5hbHl6ZVBhY2thZ2UoYXJndi5wYWNrYWdlIGFzIHN0cmluZyk7XG4gICAgICAgICAgY29uc3Qgd2VpZ2h0cyA9IHJlc3VsdC5zaWduYWxXZWlnaHRzO1xuXG4gICAgICAgICAgY29uc29sZS5sb2coY2hhbGsuYm9sZCgnXFxuTElCUkFSWTonKSwgY2hhbGsuYmx1ZShyZXN1bHQucGFja2FnZU5hbWUpKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5ib2xkKCdWRVJTSU9OOicpLCBjaGFsay5ibHVlKHJlc3VsdC52ZXJzaW9uKSk7XG5cbiAgICAgICAgICAvLyBDb2xvciBvdmVyYWxsIHNjb3JlIGJhc2VkIG9uIHZhbHVlXG4gICAgICAgICAgbGV0IHNjb3JlQ29sb3I7XG4gICAgICAgICAgaWYgKHJlc3VsdC50b3RhbFNjb3JlID49IDgwKSB7XG4gICAgICAgICAgICBzY29yZUNvbG9yID0gY2hhbGsuZ3JlZW47XG4gICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQudG90YWxTY29yZSA+PSA2MCkge1xuICAgICAgICAgICAgc2NvcmVDb2xvciA9IGNoYWxrLnllbGxvdztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2NvcmVDb2xvciA9IGNoYWxrLnJlZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc29sZS5sb2coY2hhbGsuYm9sZCgnXFxuT1ZFUkFMTCBTQ09SRTonKSwgc2NvcmVDb2xvcihgJHtyZXN1bHQudG90YWxTY29yZX0vMTAwYCkpO1xuXG4gICAgICAgICAgY29uc29sZS5sb2coY2hhbGsuZ3JheSgnXFxuLS0tJykpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGNoYWxrLmJvbGQoJ1xcblNVQlNDT1JFUycpKTtcblxuICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHJlc3VsdC5waWxsYXJTY29yZXMpLmZvckVhY2goKFtwaWxsYXIsIHNjb3JlXSkgPT4ge1xuICAgICAgICAgICAgLy8gQ29sb3Igc3Vic2NvcmUgYmFzZWQgb24gdmFsdWVcbiAgICAgICAgICAgIGxldCBwaWxsYXJDb2xvcjtcbiAgICAgICAgICAgIGlmIChzY29yZSA+PSA4MCkge1xuICAgICAgICAgICAgICBwaWxsYXJDb2xvciA9IGNoYWxrLmdyZWVuO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzY29yZSA+PSA2MCkge1xuICAgICAgICAgICAgICBwaWxsYXJDb2xvciA9IGNoYWxrLnllbGxvdztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHBpbGxhckNvbG9yID0gY2hhbGsucmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2coYCAgJHtjaGFsay5jeWFuKHBpbGxhci5wYWRFbmQoMTIpKX06ICR7cGlsbGFyQ29sb3Ioc2NvcmUudG9TdHJpbmcoKS5wYWRTdGFydCgxMikgKyAnLzEwMCcpfWApO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gT25seSBzaG93IGRldGFpbGVkIHNpZ25hbCBpbmZvcm1hdGlvbiBpZiBkZXRhaWxzIGZsYWcgaXMgc2V0XG4gICAgICAgICAgaWYgKGFyZ3YuZGV0YWlscykge1xuICAgICAgICAgICAgZGlzcGxheURldGFpbHNTaWduYWxJbmZvKHJlc3VsdC5zaWduYWxTY29yZXMsIHdlaWdodHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGNoYWxrLnJlZCgnRXJyb3I6JyksIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogZXJyb3IpO1xuICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICApXG4gICAgLmhlbHAoKVxuICAgIC5hcmd2O1xufSJdfQ==